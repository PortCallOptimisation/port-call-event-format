## This manual is still in a concept fase and is open for debat and will most likely change

# Convert carrier schedule to port call events
We frequently receive the question from carriers how they can share their schedule with Pronto.

This manual contains instructions on how to do this.

## Example carrier schedule
For this manual we take a fictitious port "Gilo" with UNLOCODE `XXGIL`. Gilo has a single terminal managing the ports 3 berth `Gilo 1`, `Gilo 2` and `Gilo 3`.

At 2018-01-01 14:00 the latest schedule for the carrier is as follows:

### 
| ID       | Port call     | Port  | Vessel name | IMO     | Arrival Port     | Departure Port   |
|----------|---------------|-------|-------------|---------|------------------|------------------|
| 077b9b08 | XXGIL18000001 | XXGIL | BUKHA       | 9500936 | 2018-01-03 17:00 | 2018-01-04 09:00 |
| f0b2426f | XXGIL18000032 | XXGIL | PENELOPE    | 9402914 | 2018-01-05 19:00 | 2018-01-08 17:00 |

ID: Your internal unique, non-reused ID for the visit


##### Detail view 077b9b08
| ID        | Port call     | Vessel name | IMO     | Berth  | Arrival Berth    | Departure Berth  |
|-----------|---------------|-------------|---------|--------|------------------|------------------|
| 077b9b081 | XXGIL18000001 | BUKHA       | 9500936 | Gilo 1 | 2018-01-03 20:00 | 2018-01-04 07:00 |

##### Detail view f0b2426f
| ID        | Port call     | Vessel name | IMO     | Berth  | Arrival Berth    | Departure Berth  |
|-----------|---------------|-------------|---------|--------|------------------|------------------|
| f0b2426f1 | XXGIL18000032 | PENELOPE    | 9402914 | Gilo 3 | 2018-01-05 21:00 | 2018-01-06 19:00 |
| f0b2426f2 | XXGIL18000032 | PENELOPE    | 9402914 | Gilo 2 | 2018-01-06 20:00 | 2018-01-08 15:00 |


## Sending events
In order to share the schedule with other partier the carrier should convert the schedule into events.
If we want to send the ETA Port for visit `077b9b08`, the event should be as follows:

##### 077b9b08 ETA Port
```javascript
{
  // A random or hash-based UUID generated by the carrier
  "uuid": "2ccf0ee9-9f65-4b3f-ae55-0031bc315ec2",
  // The event format version used
  "version": "3.1.1",
  // A string identifying the carrier as agreed with other participants
  "source": "Carrier X",
  // The event type of this timestamp (see table below for other event types)
  "eventType": "port.eta.carrier",
  // The timestamp at which this event was created, in UTC
  "recordTime": "2018-01-01T12:00:00Z",
  // The expected time of arrival (ETA) port of the ship
  "eventTime": "2018-01-03T15:00:00Z",
  // The ship identifiers and (optional) name
  "ship": {
    "imo": "9500936",
    "name": "BUKHA"
  },
  // The UNLOCODE of the port which the ship will visit
  "port": "XXGIL",
  //
  "portcallId": "",
  "location": {
    "type": "port",
    // Our port already has GLNs assigned so we can use those
    "gln": "006141400"
  }
}
```
**Note**: *Be aware that the event times should be in UTC (Zulu) time. Since our carrier is currently in the +02:00 time zone, two hours need to be suntracted from the local time. We recommend using a date-time library for this.*


### Event types
| Event name               | Identifier                     | Description                                                                  |
|--------------------------|--------------------------------|------------------------------------------------------------------------------|
| ETA Port                 | port.eta.carrier               | The estimated time the ship will arrive at the port.                         |
| ATA Port                 | port.ata.carrier               | The actual time the ship has arrived in the port.                            |
| ETA Pilot Boarding Place | pilotBoardingPlace.eta.carrier | The estimated time the ship has arrived at the pilot boarding place          |
| ATA Pilot Boarding Place | pilotBoardingPlace.ata.carrier | The actual time the ship will arrive at the pilot boarding place             |
| ETA Berth                | berth.eta.carrier              | The estimated time the ship will arrive at the berth (before it's moored)    |
| ATA Berth                | berth.ata.carrier              | The actual time the ship has arrived at the berth                            |
| ETD Berth                | berth.etd.carrier              | The estimated time the ship will depart from the berth (after it's unmoored) |
| ATD Berth                | berth.atd.carrier              | The actual time the ship has departed from the berth                         |
| ETD Pilot Boarding Place | pilotBoardingPlace.etd.carrier | The estimated time the ship has depart through the pilot boarding place      |
| ATD Pilot Boarding Place | pilotBoardingPlace.atd.carrier | The actual time the ship will depart through pilot boarding place            |
| ETD Port                 | port.etd.carrier               | The estimated time the ship will depart from the port                        |
| ATD Port                 | port.atd.carrier               | The actual time the ship has departed from the port                          |
| Cancel berth visit       | berth.cancel.carrier           | A previously planned visit to a specific berth will no longer happen         |
| Cancel visit             | port.cancel.carrier            | A previously planned visit to the port will no longer happen                 |

### Sending Updated

If a timestamp changes in your system, you should create a new event to share this update with the other parties. Say the ETA Port for the BUKHA we send earlier becomes and ATA, we now send a new ATA event:
```javascript
{
  // A random or hash-based UUID generated by the carrier
  "uuid": "db1fa9e7-1e24-4fba-96db-6977a650fed2",
  // The event format version used
  "version": "3.1.1",
  // A string identifying the carrier as agreed with other participants
  "source": "Carrier X",
  // The event type of this timestamp (see table below for other event types)
  "eventType": "port.ata.carrier",
  // The timestamp at which this event was created, in UTC
  "recordTime": "2018-01-04T19:12:04Z",
  // The expected time of arrival (ETA) port of the ship
  "eventTime": "2018-01-04T19:09:27Z",
  // The ship identifiers and (optional) name
  "ship": {
    "imo": "9500936",
    "name": "BUKHA"
  },
  // The UNLOCODE of the port which the ship will visit
  "port": "XXGIL",
  //
  "portcallId": "",
  "location": {
    "type": "port"
  }
}
```


### Cancellations

#### Berth visit
Sometimes a visit is already scheduled to a port, and the carrier has already sent out events for this visit, but for some reason the ship will not visit the port (or part of it) anymore.

In this case, the carrier will need to send a cancellation event to the other parties to make sure they are aware that the scheduled visit will no longer happen. 

**Note**: *There is currently no way to "un-cancel" a visit and the ... cannot be re-used. It is an error to send new events with a id of a visit that has been cancelled. If a (berth) visit was cancelled but then re-scheduled, it need to have a new id.*

```javascript
{
    "uuid": "1915f10d-792c-4c88-a5ad-8bee91689b53",
    "version": "3.1.1",
    "source": "Carrier X",
    "eventType": "berth.cancel.terminal",
    "recordTime": "2018-06-08T13:30:00Z",
    "eventTime": "2018-06-08T13:30:00Z",
    "ship": {
        "imo": "9500936",
        "name": "BUKHA"
    },
    "port": "XXGIL",
    "portcallId": "XXGIL18000144",
    "location": {
      "type": "berth",
      "gln": "0061414000031",
      "name": "Gilo 1"
    },
    "context": {
      "berthVisitId": "BID-XXGILTerminal-077b9b08"
    }
}
```

#### Visit
If the visit to the 

### Other events

##### 077b9b081 ETA Berth
```javascript
{
  "uuid": "5c8745fd-93f3-4155-9205-2df5d6e354c2",
  "version": "3.1.1",
  "source": "Carrier X",
  "eventType": "berth.eta.agent",
  "recordTime": "2018-01-01T12:00:00Z",
  "eventTime": "2018-01-03T18:00:00Z",
  "ship": {
    "imo": "9500936",
    "name": "BUKHA"
  }
}
```

##### 077b9b081 ETD Berth
```javascript
{
  "uuid": "5c8745fd-93f3-4155-9205-2df5d6e354c2",
  "version": "3.1.1",
  "source": "Carrier X",
  "eventType": "berth.etd.agent",
  "recordTime": "2018-01-01T12:00:00Z",
  "eventTime": "2018-01-04T05:00:00Z",
  "ship": {
    "imo": "9500936",
    "name": "BUKHA"
  }
}
```

##### 077b9b08 ETD Port
```javascript
{
  "uuid": "5c8745fd-93f3-4155-9205-2df5d6e354c2",
  "version": "3.1.1",
  "source": "Carrier X",
  "eventType": "port.etd.agent",
  "recordTime": "2018-01-01T12:00:00Z",
  "eventTime": "",
  "ship": {
    "imo": "9500936",
    "name": "BUKHA"
  }
}
```